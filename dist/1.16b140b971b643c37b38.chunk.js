webpackJsonp([1],{52:function(t,e,i){i(58);var s=i(6)(i(56),i(61),"data-v-6d8f3a6c",null);s.options.__file="D:\\www\\iview-project\\src\\views\\pmlist.vue",s.esModule&&Object.keys(s.esModule).some(function(t){return"default"!==t&&"__esModule"!==t})&&console.error("named exports are not supported in *.vue files."),s.options.functional&&console.error("[vue-loader] pmlist.vue: functional components are not supported with templates, they should use render functions."),t.exports=s.exports},56:function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var __WEBPACK_IMPORTED_MODULE_0_qs__=__webpack_require__(18),__WEBPACK_IMPORTED_MODULE_0_qs___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_qs__);__webpack_exports__.default={data:function(){return{self:this,isEditshow:!1,pmaddModal:!1,pmNumber:"",pmExperttime:"",editedPmlist:[],state_name:{ready:"待反馈",feedback:"待接入",access:"开发中",online:"已验收"},online_times:{},columns:[{title:"PM号",key:"pmid",fixed:"left",width:80,render:function(t,e,i){return"<strong>"+t.pmid+"</strong>"}},{title:"项目名称",width:300,key:"name",fixed:"left"},{title:"对接人",width:80,key:"puser"},{title:"实施人",width:120,render:function(t,e,i){return'<i-select size="small" v-model="pmlist['+i+'].t_uid" filterable @on-change="dataEdit('+i+')">\n                                        <i-option v-for="item in huser" :value="item.value" :key="item">{{ item.label }}</i-option>\n                                    </i-select>'}},{title:"开始时间",width:160,key:"start_time",render:function(t,e,i){return t.start_time?t.start_time:"未开始"}},{title:"期望上线时间",key:"expect_time",width:160,render:function(t,e,i){return t.expect_time?t.expect_time:"-"}},{title:"开发预计上线时间",key:"evaluate_time",width:200,render:function(t,e,i){return'<Date-picker v-model=row.evaluate_time size="small" type="datetime" placeholder="开发选择时间" @on-change="dateChange('+i+',$event)"></Date-picker>'}},{title:"实际完成时间",width:160,key:"end_time",render:function(t,e,i){return t.end_time?t.end_time:"未完成"}},{title:"预估工时",width:90,key:"workhour",render:function(t,e,i){return'<i-input v-model="pmlist['+i+'].workhour" size="small" @input="dataEdit('+i+')"></i-input>'}},{title:"完成进度",width:200,key:"schedule",render:function(t,e,i){return'<i-progress :percent="'+t.schedule+'" status="active"></i-progress>\n                                <i-button type="text" size="small" icon="ios-plus-empty" @click="scheduleAdd('+i+')"></i-button>\n                                <i-button type="text" size="small" icon="ios-minus-empty" @click="scheduleMinus('+i+')"></i-button>\n                            '}},{title:"状态",key:"state",width:80,render:function(t,e,i){return"<strong>{{this.state_name[row.state]}}</strong>"}},{title:"信息反馈",key:"action",width:80,align:"center",fixed:"right",render:function(t,e,i){return'<i-button type="primary" size="small" @click="showEmail('+i+",'feedback')\">查看</i-button>"}},{title:"信息接入",key:"action",width:80,align:"center",fixed:"right",render:function(t,e,i){return'<i-button type="primary" size="small" @click="showEmail('+i+",'access')\">查看</i-button>"}},{title:"上线反馈",key:"action",width:80,align:"center",fixed:"right",render:function(t,e,i){return'<i-button type="primary" size="small" @click="showEmail('+i+",'online')\">查看</i-button>"}},{title:"操作",key:"action",width:80,align:"center",fixed:"right",render:function(t,e,i){return'<i-button type="error" size="small" @click="remove('+i+')">删除</i-button>'}}],pmlist:[],huser:[]}},methods:{showEmail:function(t,e){this.$router.push("/pmemail/"+t+"/"+e)},ok:function(){this.$Message.success("保存成功")},pmadd:function pmadd(){var vobj=this;this.$http.get(this.apihost+"/pms/add/"+this.pmNumber+"/"+Date.parse(this.pmExperttime)/1e3).then(function(response){var res=eval("("+response.data+")");200==res.status?(vobj.$Notice.success({title:"同步成功"}),vobj.pmlist=eval("("+res.message+")"),sessionStorage.setItem("pmlist",res.message)):400==res.status?vobj.$Notice.error({title:"保存失败",desc:res.message,duration:0}):vobj.$Notice.error({title:"非法请求"})}).catch(function(t){vobj.$Notice.error({title:t})})},remove:function(t){var e=this,i=this;this.$Modal.confirm({content:"<p>确认删除？</p>",loading:!0,onOk:function(){i.$http.get(e.apihost+"/pms/remove/"+e.pmlist[t].id).then(function(e){i.$Modal.remove(),"Success"==e.data?(i.$Message.success("删除成功!"),i.pmlist.splice(t,1)):i.$Notice.error({title:"抛出了一个异常",desc:e.data,duration:0})}).catch(function(t){console.warn(t)})}})},scheduleAdd:function(t){if(this.pmlist[t].schedule>=100)return!1;this.pmlist[t].schedule+=10,this.isEditshow=!0,-1==this.editedPmlist.indexOf(t)&&this.editedPmlist.push(t)},scheduleMinus:function(t){if(this.pmlist[t].schedule<=0)return!1;this.pmlist[t].schedule-=10,this.isEditshow=!0,-1==this.editedPmlist.indexOf(t)&&this.editedPmlist.push(t)},dataEdit:function(t){this.isEditshow=!0,-1==this.editedPmlist.indexOf(t)&&this.editedPmlist.push(t)},dateChange:function(t,e){this.pmlist[t].evaluate_time=e,this.isEditshow=!0,-1==this.editedPmlist.indexOf(t)&&this.editedPmlist.push(t)},dataSubmit:function dataSubmit(){var postdata=[],vobj=this;if(this.editedPmlist.length>0)for(var i in this.editedPmlist)postdata.push(this.pmlist[this.editedPmlist[i]]);this.$http.post(this.apihost+"/pms/edit",__WEBPACK_IMPORTED_MODULE_0_qs___default.a.stringify(postdata)).then(function(response){200==response.status&&(vobj.$Notice.success({title:"修改成功"}),vobj.pmlist=eval(response.data),sessionStorage.setItem("pmlist",response.data))}).catch(function(t){console.warn(t)})}},mounted:function mounted(){var vobj=this;this.$http.get(this.apihost+"/pms/lists").then(function(response){200==response.status&&(vobj.pmlist=eval(response.data),sessionStorage.setItem("pmlist",response.data))}).catch(function(t){console.warn(t)}),this.$http.get(this.apihost+"/husers/lists").then(function(response){200==response.status&&(vobj.huser=eval(response.data))}).catch(function(t){console.warn(t)})}}},58:function(t,e){},61:function(t,e,i){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("div",{staticClass:"layout-breadcrumb"},[i("Breadcrumb",[i("Breadcrumb-item",[i("Icon",{attrs:{type:"ios-home-outline"}}),t._v(" PM首页")],1),t._v(" "),i("Breadcrumb-item",[t._v("PM清单")])],1)],1),t._v(" "),i("div",{staticClass:"layout-content"},[i("div",{staticClass:"layout-content-main"},[i("Button",{staticClass:"mybutton",attrs:{type:"info",size:"small"},on:{click:function(e){t.pmaddModal=!0}}},[t._v("新增PM单")]),t._v(" "),i("Button",{directives:[{name:"show",rawName:"v-show",value:t.isEditshow,expression:"isEditshow"}],staticClass:"mybutton",attrs:{type:"warning",size:"small"},on:{click:t.dataSubmit}},[t._v("保存修改")]),t._v(" "),i("Modal",{attrs:{title:"同步PM单号"},on:{"on-ok":t.pmadd},model:{value:t.pmaddModal,callback:function(e){t.pmaddModal=e},expression:"pmaddModal"}},[i("Input",{staticStyle:{width:"300px","margin-bottom":"10px"},attrs:{placeholder:"请输入pm单号..."},model:{value:t.pmNumber,callback:function(e){t.pmNumber=e},expression:"pmNumber"}}),t._v(" "),i("Date-picker",{staticStyle:{width:"300px"},attrs:{type:"datetime",value:"yyyy-MM-dd HH:mm:ss",placeholder:"期望上线时间"},model:{value:t.pmExperttime,callback:function(e){t.pmExperttime=e},expression:"pmExperttime"}})],1),t._v(" "),i("Table",{staticStyle:{clear:"both"},attrs:{width:"1560",border:"",context:t.self,columns:t.columns,data:t.pmlist}})],1)])])},staticRenderFns:[]},t.exports.render._withStripped=!0}});